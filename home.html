<!DOCTYPE html>
<html>

  
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>BUTTON Cards</title>
  <link href="styleHome2.css" rel="stylesheet" type="text/css" />
  <link rel="icon" type="image/png" href="BC_Icon.png">
</head>

<body>

  <script>
        /*if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }*/
  </script>
  
  <!-- Header Section -->
  <div class="logoBack">
    <a class="logoLink" href="collections.html">
      <img class="logo" src="BCC_Logo.png" alt="Logo">
    </a>
    <!-- Username and "Thank you" Message -->
    <div class="user-info">
      <p id="username">Username: Missingno</p>
      <p id="token">Pack Tokens: 100</p>
      <button class="logout-button" onclick="handleLogout()">LOGOUT</button>
    </div>
  </div>
  <div class=line></div>

  <h1 class="pageTitle">Pack Store</h1>
  <div class="pack-options">
    <div class="pack-option">
      <h3>Standard Pack</h3>
      <img class="pack-image" src="Pack1.png" alt="Pack 1">
      <button class="open-pack" onclick="openPack(1)">Open Pack</button>
    </div>
  
    <div class="pack-option">
      <h3>St. Patricks Day Exclusive Variant Pack</h3>
      <img class="pack-image" src="Pack2.png" alt="Pack 2">
      <button class="open-pack" onclick="openPack(2)">Open Pack</button>
    </div>
  
    <div class="pack-option">
      <h3>Spring Exclusive Variant Pack</h3>
      <img class="pack-image" src="Pack3.png" alt="Pack 3">
      <button class="open-pack" onclick="openPack(3)">Open Pack</button>
    </div>
  </div>
  
  <img class=pack src="Pack.png" onclick="openPack()"></img>
  <h2 class=resultTitle><u>Pack Results!</u></h2>
  <h3 class=resultCards>Cards: </h3>
  <ul class=resultList>
    <li><img class=i0 src="Pack.png" onClick="enlargePack('i0')"></img></li>
    <li><img class=i1 src="Pack.png" onClick="enlargePack('i1')"></img></li>
    <li><img class=i2 src="Pack.png" onClick="enlargePack('i2')"></img></li>
    <li><img class=i3 src="Pack.png" onClick="enlargePack('i3')"></img></li>
    <li><img class=i4 src="Pack.png" onClick="enlargePack('i4')"></img></li>
    <li><img class=i5 src="Pack.png" onClick="enlargePack('i5')"></img></li>
    <li><img class=i6 src="Pack.png" onClick="enlargePack('i6')"></img></li>
    <li><img class=i7 src="Pack.png" onClick="enlargePack('i7')"></img></li>
    <li><img class=i8 src="Pack.png" onClick="enlargePack('i8')"></img></li>
    <li><img class=i9 src="Pack.png" onClick="enlargePack('i9')"></img></li>
  </ul>
  
  <script src="scriptCollect.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  
  <script>
    
    window.onload = function() {
          const currentUser = JSON.parse(localStorage.getItem('currentUser'));
          console.log(currentUser);
          if (currentUser) {
              document.getElementById('username').textContent = `Username: ${currentUser.username}`;
          } else {
              // If no user is logged in, redirect to login page
              //window.location.href = 'index.html';
          }
      }
    
    // Import the functions you need from the SDKs you need
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCLjx4Ys4qnzMfRog74NExTUHdZism8u-I",
      authDomain: "buttoncards.firebaseapp.com",
      databaseURL: "https://buttoncards-default-rtdb.firebaseio.com",
      projectId: "buttoncards",
      storageBucket: "buttoncards.firebasestorage.app",
      messagingSenderId: "1001795754069",
      appId: "1:1001795754069:web:1cbf4305a68f9b45eb5cdc",
      measurementId: "G-F56PTH5YNL"
    };
  
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function updateCards() {
      const userRef = db.collection('users');
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const userQuery = await userRef
            .where('name', '==', currentUser.username.toLowerCase())
            .get();
      
      if (!userQuery.empty) {
            const doc = userQuery.docs[0];

        
            const currentLogins = doc.data().logins;
            const currentCards = doc.data().cards;
            const newLogins = currentLogins + 1;
            const newCards = currentCards.concat(["01-5"]);
            console.log(doc.data());
            console.log(doc.data().logins);
            
            await doc.ref.update({
                cards: newCards,
                logins: newLogins
            });
      } else {
      await userRef.add({
          name: currentUser.username.toLowerCase(),
          cards: [],
          logins: 0
      });
      }
    }

    function handleLogout() {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('currentUser');
        window.location.href = 'index.html';
    }
  </script>
</body>

</html>
